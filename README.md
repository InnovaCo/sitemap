# Генератор sitemap.xml [![Build Status](https://travis-ci.org/InnovaCo/sitemap.svg?branch=master)](https://travis-ci.org/InnovaCo/sitemap)

Автоматически генерирует файл `sitemap.xml` на основе файловой структуры. Также понимает вложенные `sitemap.xml` и импортирует данные из него, автоматически обновляя ссылки в этом файле.

Пример использования:

```js
var sitemap = require('sitemap');

sitemap('./htdocs', function(err, sm) {
    if (err) {
        return console.error(sm);
    }

    // пройдёмся по всем ссылкам карты сайта
    sm.items.forEach(function(item) {
        console.log(item.url);
    });
    
    // вывод карты сайта в виде XML
    var fs = require('fs');
    fs.writeFile('./sitemap.xml', sm.toXml(), function(err) {
        console.log('Done!');
    });
});
```

## Аргументы

* `dir` (String): путь к папке, которую нужно просканировать и из которой нужно создать карту сайта.
* `options` (Object): необязательный параметр; список опций для генератора.
    * `prefix`: префикс, который нужно добавить всем сгенерированным ссылкам.
    * `ext`: массив с расширениями файлов, которые нужно добавить в карту сайта. По умолчанию `['.html', '.htm']`.
    * `index`: массив индексных файлов. Сам индексный файл не попапдает в карту сайта, вместо него добавляется родительская папка. По умолчанию `['index.html', 'index.htm']`.
    * `lastModified`: булевое значаение, означающее, стоит ли записать дату последнего изменения файла в карту сайта. По умолчанию `true`.
    * `includeSitemap`: булевое значение, означающее, стоит ли включать содержимое вложенных файлов `sitemap.xml` в генерируемую карту сайта. Этот параметр меняет алгоритм сканирования директорий (см. ниже). По умолчанию `true`.
* `callback` (Function): функция, вызываемая после генерации карты сайта. Принимает два аргумента: `error` и `sitemap` — объект со структурой сайта.

## Алгоритм работы генератора `sitemap.xml`

Генератор начинает сканировать содержимое указанной папки. Если находит файл, которые соответствует параметру `index` или `ext`, то эта папка (либо файл в папке) добавляется в карту сайта. Для всех вложенных папок рекурсивно вызывается генератор с обновлённым свойстовм `prefix`.

Если в папке есть файл `sitemap.xml` и был передан параметр `includeSitemap`, то чтение папки прекращается (ни один файл из папки не будет добавлен в карту сайта) и вместо этого будет включено содержимое файла `sitemap.xml`, где каждому адресу будет добавлен текущий `prefix`. Таким образом можно интегрировать подсайты со своей структурой `sitemap.xml`.

### Смешиваем статические ссылки с динамически генерируемой картой сайта

Иногда, для некоторых сложных случаев, нужно статически указать несколько ссылок, которые не присутствуют в виде файлов, но при этом иметь возможность генерировать карту сайта на основе файловой структуры.

Для решения этой проблемы нужно создать файл `sitemap.xml`, в котором прописать нужные ссылки (см. [спецификацию](http://www.sitemaps.org/protocol.html)) и воспользоваться инструкцией `<?generate-sitemap?>`:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
    <url>
        <loc>/page/?foo=bar</loc>
        <changefreq>monthly</changefreq>
    </url>

    <?generate-sitemap prefix="/a/" dir="../path/to/dir"?>
</urlset>
```

В этом примере на выходе вместо инструкции `<?generate-sitemap?>` будут выведены ссылки, сгенерированные на основе папки `../path/to/dir`.

Инструкция `<?generate-sitemap?>` может принимать следующие *опциональные* аргументы:

* `prefix` — префикс, который нужно добавить в ссылки для найденных файлов. *Этот префикс автоматически объединяется с контекстным параметром `prefix`*.
* `dir` — директория, которую нужно просканировать для получения списка ссылок. По умолчанию сканируется текущая для `sitemap.xml` директория.

Инструкций `<?generate-sitemap?>` может быть сколько угодно в одном файле.
